        // Обработчик состояния аутентификации
        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('app-page').style.display = 'block';
                document.getElementById('user-email').textContent = user.email;
                loadFromFirebase();
                initApp();
            } else {
                document.getElementById('login-page').style.display = 'block';
                document.getElementById('app-page').style.display = 'none';
            }
        });

        // Обработка переключателя входа
        document.addEventListener('DOMContentLoaded', function() {
            const switchElement = document.getElementById('switch');
            let isDragging = false;
            let startX;
            let currentX;
            
            // Функция для обновления позиции переключателя
            function updateSwitchPosition(x) {
                const trackRect = switchElement.getBoundingClientRect();
                const thumb = switchElement.querySelector('.switch-thumb');
                const fill = switchElement.querySelector('.switch-fill');
                
                let newLeft = x - trackRect.left - (thumb.offsetWidth / 2);
                newLeft = Math.max(5, Math.min(newLeft, trackRect.width - thumb.offsetWidth - 5));
                
                thumb.style.left = newLeft + 'px';
                fill.style.width = (newLeft / trackRect.width * 100) + '%';
                
                if (newLeft > trackRect.width * 0.7) {
                    switchElement.classList.add('swiped');
                } else {
                    switchElement.classList.remove('swiped');
                }
            }
            
            // Функция для сброса переключателя
            function resetSwitch() {
                const thumb = switchElement.querySelector('.switch-thumb');
                const fill = switchElement.querySelector('.switch-fill');
                
                thumb.style.left = '5px';
                fill.style.width = '0';
                switchElement.classList.remove('swiped');
            }
            
            // Функция для завершения входа
            function completeLogin() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                if (!email || !password) {
                    alert('Пожалуйста, введите email и пароль');
                    resetSwitch();
                    return;
                }
                
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // Вход успешен
                        console.log('Вход выполнен:', userCredential.user);
                    })
                    .catch((error) => {
                        console.error('Ошибка входа:', error);
                        let errorMessage = 'Ошибка входа: ';
                        
                        switch (error.code) {
                            case 'auth/invalid-email':
                                errorMessage += 'Неверный формат email';
                                break;
                            case 'auth/user-disabled':
                                errorMessage += 'Пользователь отключен';
                                break;
                            case 'auth/user-not-found':
                                errorMessage += 'Пользователь не найден';
                                break;
                            case 'auth/wrong-password':
                                errorMessage += 'Неверный пароль';
                                break;
                            default:
                                errorMessage += error.message;
                        }
                        
                        alert(errorMessage);
                        resetSwitch();
                    });
            }
            
            // Обработчики событий для мыши
            switchElement.addEventListener('mousedown', function(e) {
                isDragging = true;
                startX = e.clientX;
                currentX = startX;
                switchElement.style.cursor = 'grabbing';
                updateSwitchPosition(currentX);
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                currentX = e.clientX;
                updateSwitchPosition(currentX);
            });
            
            document.addEventListener('mouseup', function() {
                if (!isDragging) return;
                isDragging = false;
                switchElement.style.cursor = 'pointer';
                
                const trackRect = switchElement.getBoundingClientRect();
                const thumb = switchElement.querySelector('.switch-thumb');
                
                if (parseInt(thumb.style.left) > trackRect.width * 0.7) {
                    completeLogin();
                } else {
                    resetSwitch();
                }
            });
            
            // Обработчики событий для touch-устройств
            switchElement.addEventListener('touchstart', function(e) {
                isDragging = true;
                startX = e.touches[0].clientX;
                currentX = startX;
                updateSwitchPosition(currentX);
                e.preventDefault();
            });
            
            document.addEventListener('touchmove', function(e) {
                if (!isDragging) return;
                currentX = e.touches[0].clientX;
                updateSwitchPosition(currentX);
                e.preventDefault();
            });
            
            document.addEventListener('touchend', function() {
                if (!isDragging) return;
                isDragging = false;
                
                const trackRect = switchElement.getBoundingClientRect();
                const thumb = switchElement.querySelector('.switch-thumb');
                
                if (parseInt(thumb.style.left) > trackRect.width * 0.7) {
                    completeLogin();
                } else {
                    resetSwitch();
                }
            });
            
            // Обработчик для вопроса (подсказки)
            document.querySelector('.question-mark').addEventListener('click', function() {
                alert('Для входа введите ваш email и пароль, затем сдвиньте переключатель вправо.');
            });
        });
    </script>
</body>
</html>
